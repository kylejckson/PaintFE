app-id: io.github.paintfe.PaintFE
runtime: org.freedesktop.Platform
runtime-version: '23.08'
sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.rust-stable
command: PaintFE

finish-args:
  # Display
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  # GPU — required for wgpu (opens /dev/dri/renderD128)
  - --device=dri
  # File access for open/save dialogs
  - --filesystem=home
  # Needed by rfd (native file dialogs via xdg-portal on modern desktops)
  - --talk-name=org.freedesktop.portal.FileChooser

build-options:
  append-path: /usr/lib/sdk/rust-stable/bin
  env:
    CARGO_HOME: /run/build/PaintFE/cargo-home
    RUST_BACKTRACE: '1'

modules:
  - name: PaintFE
    buildsystem: simple
    build-commands:
      # Vendor sources baked in via cargo-sources.json (generated offline)
      - cargo --offline fetch --manifest-path Cargo.toml
      - cargo --offline build --release
      - install -Dm755 target/release/PaintFE /app/bin/PaintFE
      # Icon
      - install -Dm644 assets/icons/ui/app_icon.png
          /app/share/icons/hicolor/256x256/apps/io.github.paintfe.PaintFE.png
      # Desktop entry
      - install -Dm644 packaging/flatpak/io.github.paintfe.PaintFE.desktop
          /app/share/applications/io.github.paintfe.PaintFE.desktop
      # AppStream metainfo
      - install -Dm644 packaging/flatpak/io.github.paintfe.PaintFE.metainfo.xml
          /app/share/metainfo/io.github.paintfe.PaintFE.metainfo.xml
    sources:
      - type: dir
        path: ../..
      # Generated by: python3 packaging/flatpak/flatpak-cargo-generator.py Cargo.lock -o packaging/flatpak/cargo-sources.json
      # (see LINUX_PACKAGING.md — must be regenerated whenever Cargo.lock changes)
      - type: file
        path: cargo-sources.json
